<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Games</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
	<style>
		:root {
			--g-page-bg: #0a0a0f;
			--g-panel: #12121a;
			--g-panel-2: #1a1a25;
			--g-accent: #9333ea;
			--g-accent-deep: #7c3aed;
			--g-shadow: rgba(147, 51, 234, 0.5);
			--g-on-accent: #f3e8ff;
			--g-text: #e8e8f0;
			--g-muted: #a0a0b8;
			--g-radius: 12px;
			--g-border: rgba(147, 51, 234, 0.2);
			--g-surface: #12121a;
			--border-thickness: 3px;
			--border-thickness-hover: 6px;
			--glow-size: 240px;
			--glow-size-hover: 340px;
			--glow-strength: 0.48;
			--card-scale-hover: 1.06;
			--card-scale-hover-lift: 1.08;
		}

		/* Image Not Found Overlay */
		.image-not-found {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: #000;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #fff;
			font-size: 0.9rem;
			font-weight: 600;
			text-align: center;
			border-radius: var(--g-radius);
			z-index: 1;
		}

		* {
			box-sizing: border-box;
		}

		html,
		body {
			min-height: 100vh;
			height: auto;
			margin: 0;
			padding: 0;
			width: 100%;
			overflow-x: hidden;
			overflow-y: auto;
		}

		body {
			margin: 0;
			padding: 0;
			padding-bottom: 80px;
			color: var(--g-text);
			font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
			position: relative;
			background: var(--g-page-bg);
		}

		.view-count {
			position: absolute;
			bottom: 8px;
			right: 8px;
			background: rgba(0, 0, 0, 0.75);
			backdrop-filter: blur(8px);
			color: white;
			padding: 4px 8px;
			border-radius: 12px;
			font-size: 0.75rem;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 4px;
			z-index: 2;
			pointer-events: none;
		}

		.view-count i {
			font-size: 0.7rem;
			opacity: 0.8;
		}

		.search-bar {
			position: sticky;
			top: 0;
			z-index: 10;
			padding: 12px;
			background: transparent;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 12px;
		}

		.input-row {
			display: flex;
			gap: 10px;
			align-items: center;
			background: var(--g-panel-2);
			border: 1px solid rgba(0, 0, 0, 0.3);
			border-radius: 999px;
			padding: 6px 8px;
		}

		.input-row:focus-within {
			border-color: rgba(147, 51, 234, 0.65);
			box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.16);
		}

		.input {
			flex: 1;
			background: transparent;
			color: var(--g-text);
			border: 0;
			outline: 0;
			height: 44px;
			padding: 0 12px;
			font-size: 16px;
			border-radius: 999px;
		}

		.input::placeholder {
			color: rgba(248, 231, 224, 0.4);
		}

		.grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
			gap: 20px;
			padding: 20px;
			max-width: 1200px;
			margin: 0 auto 40px;
			overflow: visible;
			min-height: calc(100vh - 100px);
			padding-bottom: 60px;
		}

		.no-results {
			color: #999;
			font-size: 1rem;
			padding: 2rem;
			text-align: center;
		}

		.favorite-star {
			position: absolute;
			top: 8px;
			right: 8px;
			width: 36px;
			height: 36px;
			background: linear-gradient(145deg, rgba(147, 51, 234, 0.8), rgba(124, 58, 237, 0.8));
			backdrop-filter: blur(12px);
			border: 1px solid rgba(243, 232, 255, 0.2);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			z-index: 10;
			transition: all 0.2s ease;
			box-shadow: -4px -4px 10px rgba(147, 51, 234, 0.1), 4px 4px 14px rgba(0, 0, 0, 0.5);
		}

		.favorite-star:hover {
			transform: scale(1.1);
			background: rgba(147, 51, 234, 0.6);
		}

		.favorite-star svg {
			width: 20px;
			height: 20px;
			fill: none;
			stroke: var(--g-on-accent);
			stroke-width: 2;
			transition: all 0.2s ease;
		}

		.favorite-star.favorited svg {
			fill: #ffd700;
			stroke: #ffd700;
		}

		.content-wrapper {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 20px;
			min-height: 100vh;
		}

		.content-wrapper .grid {
			width: 100%;
			padding-bottom: 80px;
		}

		.pagination {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 8px;
			padding: 12px 20px;
			flex-wrap: wrap;
			background: var(--g-surface);
			border-top: 2px solid var(--g-border);
			z-index: 1000;
		}

		.pagination button {
			min-width: 44px;
			height: 44px;
			padding: 8px 12px;
			background: rgba(31, 20, 16, 0.6);
			backdrop-filter: blur(10px);
			color: var(--g-muted);
			border: 1px solid rgba(255, 255, 255, 0.06);
			border-radius: var(--g-radius);
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.pagination button:hover:not(:disabled) {
			background: rgba(26, 26, 37, 0.7);
			border-color: rgba(147, 51, 234, 0.65);
			transform: translateY(-2px);
		}

		.pagination button:disabled {
			opacity: 0.4;
			cursor: not-allowed;
		}

		.pagination button.active {
			background: linear-gradient(180deg, var(--g-accent-deep), var(--g-accent));
			color: var(--g-on-accent);
			border-color: var(--g-accent);
		}

		.pagination .ellipsis {
			padding: 8px;
			color: var(--g-muted);
			opacity: 0.6;
		}

		.suggestion-section {
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 40px 20px 100px 20px;
			margin-top: -40px;
		}

		.suggestion-btn {
			display: inline-flex;
			align-items: center;
			gap: 12px;
			padding: 16px 32px;
			background: linear-gradient(135deg, var(--g-accent), var(--g-accent-deep));
			color: var(--g-on-accent);
			text-decoration: none;
			font-size: 1.1rem;
			font-weight: 600;
			border-radius: var(--g-radius);
			border: 2px solid transparent;
			box-shadow: 0 4px 16px var(--g-shadow);
			transition: all 0.3s ease;
			cursor: pointer;
		}

		.suggestion-btn:hover {
			transform: translateY(-2px) scale(1.05);
		}

		.game-card {
			position: relative;
			border-radius: var(--g-radius);
			overflow: hidden;
			background: var(--g-panel);
			cursor: pointer;
			transition: transform 260ms ease, box-shadow 260ms ease;
			aspect-ratio: 16 / 9;
			opacity: 0;
			animation: fadeUp 0.6s ease forwards;
		}

		.game-card:hover {
			transform: translateY(-10px) scale(1.06);
			box-shadow: 0 28px 72px rgba(147, 51, 234, 0.36), 0 10px 40px rgba(0, 0, 0, 0.5);
		}

		.game-card>img {
			display: block;
			width: 100%;
			height: 100%;
			object-fit: cover;
			border-radius: var(--g-radius);
		}

		.game-title {
			position: absolute;
			left: 0;
			right: 0;
			bottom: 0;
			padding: 12px 14px;
			font-weight: 700;
			color: var(--g-on-accent);
			background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
			text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
			font-size: 1.05rem;
			z-index: 2;
			border-radius: 0 0 var(--g-radius) var(--g-radius);
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		@keyframes fadeUp {
			from {
				opacity: 0;
				transform: translateY(20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@keyframes spin {
			from {
				transform: rotate(0deg);
			}

			to {
				transform: rotate(360deg);
			}
		}

		.scrollable-sections {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 20px 20px;
		}

		.game-section {
			margin-bottom: 32px;
		}

		.section-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 16px;
			gap: 12px;
		}

		.section-title {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--g-text);
			margin: 0;
			flex: 1;
		}

		.section-nav-btn {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			background: var(--g-panel-2);
			border: 2px solid rgba(147, 51, 234, 0.3);
			color: var(--g-text);
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
		}

		.section-nav-btn:hover:not(:disabled) {
			background: var(--g-accent);
			border-color: var(--g-accent);
			transform: scale(1.1);
		}

		.section-nav-btn:disabled {
			opacity: 0.3;
			cursor: not-allowed;
		}

		.section-scroll-container {
			position: relative;
			overflow-x: auto;
			overflow-y: hidden;
			scroll-behavior: smooth;
			scrollbar-width: none;
		}

		.section-scroll-container::-webkit-scrollbar {
			display: none;
		}

		.section-games {
			display: flex;
			gap: 16px;
			padding: 4px;
		}

		.section-game-card {
			flex: 0 0 200px;
			width: 200px;
			aspect-ratio: 3 / 4;
			border-radius: var(--g-radius);
			background: var(--g-panel);
			border: 2px solid transparent;
			cursor: pointer;
			position: relative;
			overflow: hidden;
			transition: all 0.3s ease;
		}

		.section-game-card:hover {
			transform: scale(1.05) translateY(-4px);
			border-color: var(--g-accent);
			box-shadow: 0 8px 24px var(--g-shadow);
		}

		.section-game-card .game-thumbnail {
			width: 100%;
			height: 100%;
			object-fit: cover;
			border-radius: var(--g-radius);
		}

		.section-game-card .game-info {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			padding: 12px;
			background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
		}

		.section-game-card .game-name {
			font-size: 0.9rem;
			font-weight: 600;
			color: var(--g-text);
			margin: 0 0 4px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.section-game-card .game-stats {
			display: flex;
			align-items: center;
			gap: 6px;
			font-size: 0.75rem;
			color: var(--g-muted);
		}

		.section-game-card .favorite-badge {
			position: absolute;
			top: 8px;
			right: 8px;
			background: rgba(147, 51, 234, 0.95);
			color: white;
			width: 32px;
			height: 32px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 0.85rem;
			z-index: 2;
		}

		.banner-cards .section-game-card {
			flex: 0 0 400px;
			width: 400px;
			aspect-ratio: 16 / 9;
		}

		.banner-cards .section-game-card .game-info {
			padding: 16px 20px;
		}

		.banner-cards .section-game-card .game-name {
			font-size: 1.1rem;
			font-weight: 700;
		}

		@media (max-width: 768px) {
			.section-nav-btn {
				display: none;
			}

			.section-game-card {
				flex: 0 0 140px;
				width: 140px;
			}

			.banner-cards .section-game-card {
				flex: 0 0 280px;
				width: 280px;
			}
		}

		/* Game Loader Styles */
		#gameLoaderView {
			display: none;
			min-height: 100vh;
			padding: 20px;
			padding-bottom: 100px;
		}

		#gameLoaderView.active {
			display: block;
		}

		#gamesListView.hidden {
			display: none;
		}

		.loader-wrapper {
			max-width: 1200px;
			margin: 0 auto;
		}

		.back-btn {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 12px 20px;
			background: var(--g-panel);
			color: var(--g-text);
			border: 2px solid var(--g-border);
			border-radius: var(--g-radius);
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
			margin-bottom: 20px;
		}

		.back-btn:hover {
			background: var(--g-accent);
			border-color: var(--g-accent);
		}

		.game-container {
			position: relative;
			width: 100%;
			aspect-ratio: 16 / 9;
			background: var(--g-panel);
			border-radius: var(--g-radius);
			overflow: hidden;
			margin-bottom: 20px;
		}

		.game-container img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.game-container iframe {
			width: 100%;
			height: 100%;
			border: none;
		}

		.play-overlay {
			position: absolute;
			inset: 0;
			background: rgba(0, 0, 0, 0.6);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 20px;
			cursor: pointer;
			transition: background 0.3s ease;
			z-index: 10;
		}

		.play-overlay:hover {
			background: rgba(0, 0, 0, 0.4);
		}

		.play-overlay.hidden {
			display: none;
		}

		.play-btn {
			width: 80px;
			height: 80px;
			background: var(--g-accent);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 8px 32px var(--g-shadow);
			transition: transform 0.3s ease;
		}

		.play-overlay:hover .play-btn {
			transform: scale(1.1);
		}

		.play-btn i {
			font-size: 2rem;
			color: white;
			margin-left: 4px;
		}

		.play-text {
			font-size: 1.5rem;
			font-weight: 700;
			color: white;
			text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
		}

		.game-footer {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 16px;
			padding: 16px;
			background: var(--g-panel);
			border-radius: var(--g-radius);
			margin-bottom: 20px;
			flex-wrap: wrap;
		}

		.game-footer-title {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--g-text);
		}

		.game-footer-actions {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.action-btn {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 10px 16px;
			background: var(--g-panel-2);
			color: var(--g-text);
			border: 2px solid var(--g-border);
			border-radius: var(--g-radius);
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.action-btn:hover {
			border-color: var(--g-accent);
			background: rgba(147, 51, 234, 0.2);
		}

		.action-btn.active {
			background: var(--g-accent);
			border-color: var(--g-accent);
		}

		.action-btn i {
			font-size: 1rem;
		}

		.fullscreen-btn {
			padding: 10px 16px;
			background: var(--g-accent);
			color: white;
			border: none;
			border-radius: var(--g-radius);
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s ease;
		}

		.fullscreen-btn:hover {
			transform: scale(1.05);
		}

		.related-section {
			margin-top: 40px;
		}

		.related-title {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--g-text);
			margin-bottom: 20px;
		}

		.related-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 16px;
		}

		.related-card {
			position: relative;
			aspect-ratio: 16 / 9;
			border-radius: var(--g-radius);
			overflow: hidden;
			cursor: pointer;
			transition: transform 0.3s ease;
		}

		.related-card:hover {
			transform: scale(1.05);
		}

		.related-card img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.related-card .overlay {
			position: absolute;
			inset: 0;
			background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
			display: flex;
			align-items: flex-end;
			padding: 12px;
		}

		.related-card .overlay span {
			font-size: 0.9rem;
			font-weight: 600;
			color: white;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
	</style>
</head>

<body>

	<!-- Games List View -->
	<div id="gamesListView">
		<div class="search-bar">
			<div class="container">
				<div class="input-row">
					<input class="input" id="searchInput" type="text" placeholder="Search Games Here..." autocomplete="off" />
        </div>
				</div>
			</div>

			<div class="scrollable-sections" id="scrollableSections">
				<div class="game-section" id="recentlyPlayedSection" style="display: none;">
					<div class="section-header">
						<h2 class="section-title">Recently Played</h2>
						<button class="section-nav-btn section-nav-left" disabled><i class="fas fa-chevron-left"></i></button>
						<button class="section-nav-btn section-nav-right"><i class="fas fa-chevron-right"></i></button>
					</div>
					<div class="section-scroll-container">
						<div class="section-games" id="recentlyPlayedGames"></div>
					</div>
				</div>

				<div class="game-section banner-section" id="mostPopularSection">
					<div class="section-header">
						<h2 class="section-title">Most Popular</h2>
						<button class="section-nav-btn section-nav-left" disabled><i class="fas fa-chevron-left"></i></button>
						<button class="section-nav-btn section-nav-right"><i class="fas fa-chevron-right"></i></button>
					</div>
					<div class="section-scroll-container">
						<div class="section-games banner-cards" id="mostPopularGames"></div>
					</div>
				</div>
			</div>

			<div class="content-wrapper">
				<h2 class="section-title" style="margin: 24px 0 16px; padding: 0 20px;">All Games</h2>
				<div class="grid" id="gameGrid"></div>
			</div>

			<div class="pagination" id="pagination"></div>

			<div class="game-section" id="yourFavoritesSection"
				style="display: none; margin: 40px auto; max-width: 1200px; padding: 0 20px;">
				<div class="section-header">
					<h2 class="section-title">Your Favorites</h2>
					<button class="section-nav-btn section-nav-left" disabled><i class="fas fa-chevron-left"></i></button>
					<button class="section-nav-btn section-nav-right"><i class="fas fa-chevron-right"></i></button>
				</div>
				<div class="section-scroll-container">
					<div class="section-games" id="yourFavoritesGames"></div>
				</div>
			</div>

			<div style="height: 40px;"></div>

			<div class="suggestion-section">
				<a href="https://forms.gle/f8r6tPEMnobGoH5g8" target="_blank" rel="noopener noreferrer"
					class="suggestion-btn">
					<i class="fas fa-lightbulb"></i>
					<span>Suggest a Game</span>
				</a>
			</div>
		</div>

		<!-- Game Loader View -->
		<div id="gameLoaderView">
			<div class="loader-wrapper">
				<button class="back-btn" id="backBtn">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Games</span>
      </button>

				<div class="game-container" id="gameContainer">
					<img id="gameThumbnail" src="" alt="" />
					<div class="play-overlay" id="playOverlay">
						<div class="play-btn">
							<i class="fas fa-play"></i>
						</div>
						<span class="play-text">Play Now</span>
					</div>
				</div>

				<div class="game-footer">
					<div class="game-footer-title" id="gameTitle"></div>
					<div class="game-footer-actions">
						<button class="action-btn" id="favoriteBtn">
            <i class="fas fa-heart"></i>
            <span>Favorite</span>
          </button>
						<button class="fullscreen-btn" id="newTabBtn">
            <i class="fas fa-expand"></i>
            <span>Fullscreen</span>
          </button>
						<button class="fullscreen-btn" id="fullscreenBtn" style="display: none;">
            <i class="fas fa-expand"></i>
            <span>Fullscreen</span>
          </button>
					</div>
				</div>

				<div class="related-section">
					<h2 class="related-title">More Games</h2>
					<div class="related-grid" id="relatedGrid"></div>
				</div>
			</div>
		</div>

		<script>
			(async function(){
    // ============================================
    // CONFIGURATION - CHANGE THIS URL TO YOUR GITHUB RAW URL
    // ============================================
    const GAME_INFO_URL = 'https://cdn.jsdelivr.net/gh/nexora240-lgtm/Nexora@main/game-info.json';

    const GAMES_PER_PAGE = 100;
    let currentPage = 1;
    let allGames = [];
    let filteredGames = [];
    let currentGame = null;
    let gameIframe = null;

    // Favorites Manager
    const FavoritesManager = {
      get() {
        try {
          const saved = localStorage.getItem('nexora_favorites');
          return saved ? JSON.parse(saved) : [];
        } catch (e) {
          return [];
        }
      },
      set(favorites) {
        localStorage.setItem('nexora_favorites', JSON.stringify(favorites));
      },
      toggle(gameTitle) {
        const favorites = this.get();
        const index = favorites.indexOf(gameTitle);
        if (index > -1) {
          favorites.splice(index, 1);
        } else {
          favorites.push(gameTitle);
        }
        this.set(favorites);
        return index === -1;
      },
      isFavorited(gameTitle) {
        return this.get().includes(gameTitle);
      }
    };

    // Recently Played Manager
    const RecentlyPlayedManager = {
      get() {
        try {
          const recent = localStorage.getItem('nexora_recently_played');
          return recent ? JSON.parse(recent) : [];
        } catch (e) {
          return [];
        }
      },
      add(gameTitle) {
        const recent = this.get();
        const filtered = recent.filter(title => title !== gameTitle);
        filtered.unshift(gameTitle);
        const trimmed = filtered.slice(0, 20);
        localStorage.setItem('nexora_recently_played', JSON.stringify(trimmed));
      }
    };

    // Load games
    try {
      const resp = await fetch(GAME_INFO_URL);
      const rawGames = await resp.json();
      // Filter out invalid games (missing title, thumbnail, or file)
      allGames = rawGames.filter(g => g && g.title && g.thumbnail && g.file);
      console.log(`Loaded ${allGames.length} valid games out of ${rawGames.length}`);
    } catch (e) {
      console.error('Failed to load games:', e);
      document.getElementById('gameGrid').innerHTML = '<div class="no-results">Failed to load games. Please check your internet connection.</div>';
      return;
    }

    // Fuzzy search
    function fuzzyScore(query, text) {
      if (!query) return 1;
      query = query.toLowerCase();
      text = text.toLowerCase();
      if (text === query) return 1000;
      if (text.startsWith(query)) return 500;
      const idx = text.indexOf(query);
      if (idx !== -1) return 300 - idx;
      let qIdx = 0;
      for (let i = 0; i < text.length && qIdx < query.length; i++) {
        if (text[i] === query[qIdx]) qIdx++;
      }
      if (qIdx !== query.length) return -Infinity;
      return 100;
    }

    // Render section card
    function renderSectionCard(game) {
      if (!game || !game.thumbnail || !game.file) return null;

      const isFavorite = FavoritesManager.isFavorited(game.title);
      const card = document.createElement('div');
      card.className = 'section-game-card';

      const img = document.createElement('img');
      img.className = 'game-thumbnail';
      img.src = game.thumbnail;
      img.alt = game.title || '';
      img.loading = 'lazy';
      img.onerror = () => {
        img.style.display = 'none';
        const notFound = document.createElement('div');
        notFound.className = 'image-not-found';
        notFound.textContent = 'Image Not Found';
        card.insertBefore(notFound, card.firstChild);
      };

      card.appendChild(img);

      if (isFavorite) {
        const badge = document.createElement('div');
        badge.className = 'favorite-badge';
        badge.innerHTML = '<i class="fas fa-heart"></i>';
        card.appendChild(badge);
      }

      const info = document.createElement('div');
      info.className = 'game-info';
      info.innerHTML = `<div class="game-name">${game.title || 'Unknown'}</div>`;
      card.appendChild(info);

      card.onclick = () => openGame(game);
      return card;
    }

    // Render scrollable section
    function renderScrollableSection(sectionId, games) {
      const container = document.getElementById(sectionId);
      const section = container.closest('.game-section');

      if (!games || games.length === 0) {
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';
      container.innerHTML = '';
      games.forEach(game => {
        const card = renderSectionCard(game);
        if (card) container.appendChild(card);
      });
      setupSectionNavigation(section);
    }

    // Setup section navigation
    function setupSectionNavigation(section) {
      const scrollContainer = section.querySelector('.section-scroll-container');
      const leftBtn = section.querySelector('.section-nav-left');
      const rightBtn = section.querySelector('.section-nav-right');

      if (!scrollContainer || !leftBtn || !rightBtn) return;

      const newLeftBtn = leftBtn.cloneNode(true);
      const newRightBtn = rightBtn.cloneNode(true);
      leftBtn.parentNode.replaceChild(newLeftBtn, leftBtn);
      rightBtn.parentNode.replaceChild(newRightBtn, rightBtn);

      function updateButtons() {
        const { scrollLeft, scrollWidth, clientWidth } = scrollContainer;
        newLeftBtn.disabled = scrollLeft <= 0;
        newRightBtn.disabled = scrollLeft + clientWidth >= scrollWidth - 1;
      }

      newLeftBtn.onclick = () => {
        scrollContainer.scrollBy({ left: -600, behavior: 'smooth' });
        setTimeout(updateButtons, 300);
      };
      newRightBtn.onclick = () => {
        scrollContainer.scrollBy({ left: 600, behavior: 'smooth' });
        setTimeout(updateButtons, 300);
      };
      scrollContainer.addEventListener('scroll', updateButtons);
      updateButtons();
    }

    // Image validity cache (persisted in localStorage)
    const IMAGE_CACHE_KEY = 'nexora_valid_images';
    let validImageCache = (() => {
      try {
        const stored = localStorage.getItem(IMAGE_CACHE_KEY);
        return stored ? JSON.parse(stored) : {};
      } catch (e) {
        return {};
      }
    })();

    function saveImageCache() {
      try {
        localStorage.setItem(IMAGE_CACHE_KEY, JSON.stringify(validImageCache));
      } catch (e) { /* ignore */ }
    }

    // Check if an image URL is valid (with caching)
    function checkImage(url) {
      // Return cached result if available
      if (url in validImageCache) {
        return Promise.resolve(validImageCache[url]);
      }
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => {
          validImageCache[url] = true;
          resolve(true);
        };
        img.onerror = () => {
          validImageCache[url] = false;
          resolve(false);
        };
        img.src = url;
      });
    }

    // Get games with valid images (parallel checking with cache)
    async function getGamesWithValidImages(games, count) {
      // First, filter games that are already cached as valid
      const cachedValid = games.filter(g => validImageCache[g.thumbnail] === true);
      if (cachedValid.length >= count) {
        return cachedValid.slice(0, count);
      }

      // Check uncached games in parallel (batch of 50 at a time)
      const uncached = games.filter(g => !(g.thumbnail in validImageCache));
      const batchSize = 50;
      const batch = uncached.slice(0, batchSize);

      await Promise.all(batch.map(game => checkImage(game.thumbnail)));
      saveImageCache();

      // Now filter all games by cached validity
      const validGames = games.filter(g => validImageCache[g.thumbnail] === true);
      return validGames.slice(0, count);
    }

    // Render all sections
    async function renderAllSections() {
      // Recently Played
      const recentTitles = RecentlyPlayedManager.get();
      const recentGames = recentTitles
        .map(title => allGames.find(g => g.title === title))
        .filter(g => g)
        .slice(0, 15);
      renderScrollableSection('recentlyPlayedGames', recentGames);

      // Most Popular - only show games with valid images (uses cache)
      const shuffled = [...allGames].sort(() => Math.random() - 0.5);
      const validPopularGames = await getGamesWithValidImages(shuffled, 20);
      renderScrollableSection('mostPopularGames', validPopularGames);

      // Your Favorites
      const favTitles = FavoritesManager.get();
      const favGames = favTitles
        .map(title => allGames.find(g => g.title === title))
        .filter(g => g)
        .slice(0, 15);
      renderScrollableSection('yourFavoritesGames', favGames);
    }

    // Render pagination
    function renderPagination(totalGames) {
      const totalPages = Math.ceil(totalGames / GAMES_PER_PAGE);
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
      }
      pagination.style.display = 'flex';

      const prevBtn = document.createElement('button');
      prevBtn.textContent = '‹';
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          window.scrollTo(0, 0);
          initGames(document.getElementById('searchInput').value);
        }
      };
      pagination.appendChild(prevBtn);

      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, startPage + 4);
      if (endPage === totalPages) startPage = Math.max(1, totalPages - 4);

      if (startPage > 1) {
        const ellipsis = document.createElement('span');
        ellipsis.className = 'ellipsis';
        ellipsis.textContent = '...';
        pagination.appendChild(ellipsis);
      }

      for (let page = startPage; page <= endPage; page++) {
        const btn = document.createElement('button');
        btn.textContent = page;
        btn.className = page === currentPage ? 'active' : '';
        btn.onclick = () => {
          currentPage = page;
          window.scrollTo(0, 0);
          initGames(document.getElementById('searchInput').value);
        };
        pagination.appendChild(btn);
      }

      if (endPage < totalPages) {
        const ellipsis = document.createElement('span');
        ellipsis.className = 'ellipsis';
        ellipsis.textContent = '...';
        pagination.appendChild(ellipsis);
      }

      const nextBtn = document.createElement('button');
      nextBtn.textContent = '›';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          window.scrollTo(0, 0);
          initGames(document.getElementById('searchInput').value);
        }
      };
      pagination.appendChild(nextBtn);
    }

    // Render game grid
    function initGames(filter = '') {
      const grid = document.getElementById('gameGrid');
      grid.innerHTML = '';

      const candidates = allGames.map(g => ({
        game: g,
        score: fuzzyScore(filter.trim(), g.title || '')
      }))
      .filter(item => item.score !== -Infinity)
      .sort((a, b) => b.score - a.score);

      filteredGames = candidates;
      const totalGames = candidates.length;
      const startIndex = (currentPage - 1) * GAMES_PER_PAGE;
      const endIndex = Math.min(startIndex + GAMES_PER_PAGE, totalGames);
      const pageGames = candidates.slice(startIndex, endIndex);

      renderPagination(totalGames);

      pageGames.forEach((cand, index) => {
        const game = cand.game;
        const card = document.createElement('div');
        card.className = 'game-card';
        card.style.setProperty('--card-index', index);
        card.style.animationDelay = `${index * 0.03}s`;
        card.onclick = () => openGame(game);

        const img = document.createElement('img');
        img.src = game.thumbnail;
        img.alt = game.title;
        img.loading = 'lazy';
        img.onerror = () => {
          img.style.display = 'none';
          const notFound = document.createElement('div');
          notFound.className = 'image-not-found';
          notFound.textContent = 'Image Not Found';
          card.appendChild(notFound);
        };

        const title = document.createElement('div');
        title.className = 'game-title';
        title.textContent = game.title;

        const star = document.createElement('div');
        star.className = 'favorite-star' + (FavoritesManager.isFavorited(game.title) ? ' favorited' : '');
        star.innerHTML = `<svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;
        star.onclick = (e) => {
          e.stopPropagation();
          const isFav = FavoritesManager.toggle(game.title);
          star.classList.toggle('favorited', isFav);
          renderAllSections();
        };

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(star);
        grid.appendChild(card);
      });

      if (filter && candidates.length === 0) {
        const noCard = document.createElement('div');
        noCard.className = 'no-results';
        noCard.textContent = `No results for "${filter}"`;
        grid.appendChild(noCard);
      }
    }

    // Open game in loader
    function openGame(game) {
      currentGame = game;
      RecentlyPlayedManager.add(game.title);

      document.getElementById('gamesListView').classList.add('hidden');
      document.getElementById('gameLoaderView').classList.add('active');

      // Remove existing iframe if any
      if (gameIframe) {
        if (gameIframe.src && gameIframe.src.startsWith('blob:')) {
          URL.revokeObjectURL(gameIframe.src);
        }
        gameIframe.remove();
        gameIframe = null;
      }

      // Reset thumbnail - make sure it's visible
      const thumbnail = document.getElementById('gameThumbnail');
      thumbnail.style.display = 'block';
      thumbnail.src = game.thumbnail;

      document.getElementById('gameTitle').textContent = game.title;

      // Reset play overlay to initial state
      const playOverlay = document.getElementById('playOverlay');
      playOverlay.innerHTML = `
        <div class="play-btn">
          <i class="fas fa-play"></i>
        </div>
        <span class="play-text">Play Now</span>
      `;
      playOverlay.classList.remove('hidden');
      playOverlay.style.pointerEvents = 'auto';
      playOverlay.onclick = playGame;

      // Update favorite button
      updateFavoriteButton();

      // Render related games
      renderRelatedGames();

      window.scrollTo(0, 0);
    }

    // Play game - fetch HTML and create blob URL to render the game
    async function playGame() {
      if (!currentGame) return;

      const playOverlay = document.getElementById('playOverlay');
      const container = document.getElementById('gameContainer');

      // Show loading state
      playOverlay.innerHTML = `
        <div class="play-btn" style="animation: spin 1s linear infinite;">
          <i class="fas fa-spinner"></i>
        </div>
        <span class="play-text">Loading...</span>
      `;

      // Hide overlay and thumbnail
      playOverlay.classList.add('hidden');
      document.getElementById('gameThumbnail').style.display = 'none';

      // Create iframe
      gameIframe = document.createElement('iframe');
      gameIframe.setAttribute('allowfullscreen', '');
      gameIframe.setAttribute('allow', 'autoplay; fullscreen; gamepad; microphone; camera');
      gameIframe.frameBorder = 0;
      gameIframe.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 5;';
      container.appendChild(gameIframe);

      try {
        // Fetch the game HTML
        const response = await fetch(currentGame.file);
        if (!response.ok) throw new Error('Failed to fetch game');
        const htmlContent = await response.text();

        // Create blob URL and load it
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const blobUrl = URL.createObjectURL(blob);
        gameIframe.src = blobUrl;
      } catch (error) {
        console.error('Error loading game:', error);
        // Fallback to direct URL if fetch fails
        gameIframe.src = currentGame.file;
      }
    }

    // Update favorite button
    function updateFavoriteButton() {
      const btn = document.getElementById('favoriteBtn');
      const isFav = FavoritesManager.isFavorited(currentGame.title);
      btn.classList.toggle('active', isFav);
      btn.innerHTML = `<i class="fas fa-heart"></i><span>${isFav ? 'Favorited' : 'Favorite'}</span>`;
    }

    // Render related games
    function renderRelatedGames() {
      const grid = document.getElementById('relatedGrid');
      grid.innerHTML = '';

      const related = allGames
        .filter(g => g.title !== currentGame.title)
        .sort(() => Math.random() - 0.5)
        .slice(0, 24);

      related.forEach(game => {
        const card = document.createElement('div');
        card.className = 'related-card';

        const img = document.createElement('img');
        img.src = game.thumbnail;
        img.alt = game.title;
        img.loading = 'lazy';
        img.onerror = () => {
          img.style.display = 'none';
          const notFound = document.createElement('div');
          notFound.className = 'image-not-found';
          notFound.textContent = 'Image Not Found';
          card.insertBefore(notFound, card.firstChild);
        };

        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        overlay.innerHTML = `<span>${game.title}</span>`;

        card.appendChild(img);
        card.appendChild(overlay);
        card.onclick = () => openGame(game);
        grid.appendChild(card);
      });
    }

    // Go back to games list
    function goBack() {
      if (gameIframe) {
        // Revoke blob URL to free memory
        if (gameIframe.src && gameIframe.src.startsWith('blob:')) {
          URL.revokeObjectURL(gameIframe.src);
        }
        gameIframe.remove();
        gameIframe = null;
      }

      // Show thumbnail again
      document.getElementById('gameThumbnail').style.display = 'block';

      // Reset play overlay
      const playOverlay = document.getElementById('playOverlay');
      playOverlay.innerHTML = `
        <div class="play-btn">
          <i class="fas fa-play"></i>
        </div>
        <span class="play-text">Play Now</span>
      `;
      playOverlay.classList.remove('hidden');
      playOverlay.style.pointerEvents = 'auto';
      playOverlay.onclick = playGame;

      document.getElementById('gameLoaderView').classList.remove('active');
      document.getElementById('gamesListView').classList.remove('hidden');

      renderAllSections();
      window.scrollTo(0, 0);
    }

    // Open in new about:blank tab with blob URL iframe
    async function openInNewTab() {
      if (!currentGame) return;

      try {
        // Fetch the game HTML
        const response = await fetch(currentGame.file);
        if (!response.ok) throw new Error('Failed to fetch game');
        const htmlContent = await response.text();

        // Create blob URL
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const blobUrl = URL.createObjectURL(blob);

        // Open about:blank and build the page using DOM methods
        const newTab = window.open('about:blank', '_blank');
        if (newTab) {
          const doc = newTab.document;
          doc.open();
          doc.write('<!DOCTYPE html><html><head><title>' + currentGame.title + '</title>');
          doc.write('<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;background:#000}iframe{width:100%;height:100%;border:none}</style>');
          doc.write('</head><body></body></html>');
          doc.close();

          // Create and append iframe after document is ready
          const iframe = doc.createElement('iframe');
          iframe.src = blobUrl;
          iframe.setAttribute('allowfullscreen', '');
          iframe.setAttribute('allow', 'autoplay; fullscreen; gamepad; microphone; camera');
          doc.body.appendChild(iframe);
        }
      } catch (error) {
        console.error('Error opening in new tab:', error);
        // Fallback: open game URL directly
        window.open(currentGame.file, '_blank');
      }
    }

    // Fullscreen
    function toggleFullscreen() {
      const container = document.getElementById('gameContainer');
      if (!document.fullscreenElement) {
        container.requestFullscreen().catch(err => console.log(err));
      } else {
        document.exitFullscreen();
      }
    }

    // Event listeners
    document.getElementById('searchInput').addEventListener('input', (e) => {
      currentPage = 1;
      initGames(e.target.value);
    });

    document.getElementById('searchInput').addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        e.target.value = '';
        initGames('');
        e.target.blur();
      }
    });

    document.getElementById('playOverlay').addEventListener('click', playGame);
    document.getElementById('backBtn').addEventListener('click', goBack);
    document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);

    document.getElementById('favoriteBtn').addEventListener('click', () => {
      FavoritesManager.toggle(currentGame.title);
      updateFavoriteButton();
    });

    document.getElementById('newTabBtn').addEventListener('click', openInNewTab);

    // Initialize
    renderAllSections();
    initGames();
  })();
		</script>

</body>

</html>